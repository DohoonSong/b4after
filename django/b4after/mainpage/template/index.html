<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>B4 & AFTER Final Project</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		{% load static %}

		<link rel="stylesheet" href="{% static 'assets/css/main.css' %}" />
		<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
		<!-- tensorflow javascript 모델 -->
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>

		<noscript><link rel="stylesheet" href="{% static 'assets/css/noscript.css' %}" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Sidebar -->
			<section id="sidebar">
				<div class="inner">
					<nav>
						<ul>
							<li><a href="#intro">ABOUT PROJECT</a></li>
							<li><a href="#one">Who we are</a></li>
							<li><a href="#two">Project Page</a></li>
							<li><a href="#three">Things To Do</a></li>
						</ul>
					</nav>
				</div>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Intro -->
					<section id="intro" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h1>About B4 Team Project</h1>
							<p>Hello, welcome to our project. This project leads you to experience Fantastic hand motion tracking which can control KaKao map without any device. </p>
							<p><a href="https://map.kakao.com/">About Kakao map</a>.</p>
							<ul class="actions">
								<li><a href="#one" class="button scrolly">Learn more</a></li>
							</ul>
						</div>
					</section>

				<!-- One -->
					<section id="one" class="wrapper style2 spotlights">
						<section>
							<a href="#" class="image"><img src="{% static 'images/dohun.png' %}" alt="" data-position="center center" /></a>
							<div class="content">
								<div class="inner">
									<h2>Song Do Hoon</h2>
									<p>Team Leader of B4 & AFTER.</p>
									<ul class="actions">
										<li><a href="generic.html" class="button">Learn more</a></li>
									</ul>
								</div>
							</div>
						</section>
						<section>
							<a href="#" class="image"><img src="{% static 'images/JunYeop.jpg' %}" alt="" data-position="top center" /></a>
							<div class="content">
								<div class="inner">
									<h2>Lee Joon Yup</h2>
									<p>ML Engineer</p>
									<ul class="actions">
										<li><a href="generic.html" class="button">Learn more</a></li>
									</ul>
								</div>
							</div>
						</section>
						<section>
							<a href="#" class="image"><img src="{% static 'images/sangin.jpg' %}" alt="" data-position="25% 25%" /></a>
							<div class="content">
								<div class="inner">
									<h2>Park Sang In</h2>
									<p>ML Engineer</p>
									<ul class="actions">
										<li><a href="generic.html" class="button">Learn more</a></li>
									</ul>
								</div>
							</div>
						</section>
						<section>
							<a href="#" class="image"><img src="{% static 'images/Alin.jpg' %}" alt="" data-position="25% 25%" /></a>
							<div class="content">
								<div class="inner">
									<h2>Kim A Lin</h2>
									<p>ML Engineer</p>
									<ul class="actions">
										<li><a href="generic.html" class="button">Learn more</a></li>
									</ul>
								</div>
							</div>
						</section>
					</section>

				<!-- Two -->
					<section id="two" class="wrapper style3 fade-up">
						<div class="inner">
							<h2>Start Demo</h2>
							<p>Now, you can control our map API with your hand Gesture.</p>
							<div class="features">
								<section>
									<span class="icon solid major fa-code"></span>
									<h3>KaKao Map API</h3>
										<div id="map">
											<canvas class="map_canvas" width="250px" height="200px"></canvas>
										</div>
										<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=930d7dff7ef0e0911572002a7d811db9"></script>
										<script>

											var container = document.getElementById('map');
											var options = {
												center: new kakao.maps.LatLng(33.450701, 126.570667),
												level: 3
											};
											var map = new kakao.maps.Map(container, options);

											//MAP MARKER 생성
											var marker = new kakao.maps.Marker({
												// 지도 중심좌표에 마커를 생성합니다
												position: map.getCenter()
											});
											// 지도에 마커를 표시합니다
											marker.setMap(map);


											// zoomControl , ZoomIn, Zoom Out  명령어 추가
											function zoomIn(map) {
													var curLevel = map.getLevel();
													map.setLevel(curLevel + 1, {
														animate: {
															duration: 300
														}
													});
												}
											function zoomOut(map) {
												var curLevel = map.getLevel();
												map.setLevel(curLevel - 1, {
													animate: {
														duration: 300
													}
												});
											}
											function moveMap(map, direction) {
												var curLoc = map.getCenter();
												var moveLatLon = new kakao.maps.LatLng(curLoc.x + direction.x, curLoc.y + direction.y);
												map.setCenter(moveLatLon);

											}

											kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
												var latLng = mouseEvent.latLng;
												marker.setPosition(latLng);
												var message = '클릭한 위치의 위도는 ' + latLng.getLat() + ' 이고, ';
												message += '경도는 ' + latLng.getLng() + ' 입니다';

												var resultDiv = document.getElementById('clickLatlng');
												console.log(message);
											});
									</script>
								</section>
								<section>
									<span class="icon solid major fa-code"></span>
									<h3>Your WEBCAM</h3>
									<video class="input_video" style="transform: rotateY(180deg);"></video>
									<canvas class="output_canvas" style="transform: rotateY(180deg);" width="500px" height="400px"></canvas>
									<script type="module">
										const videoElement = document.getElementsByClassName('input_video')[0];
										const canvasElement = document.getElementsByClassName('output_canvas')[0];
										const canvasCtx = canvasElement.getContext('2d');
										// tensorflow lite model loading / 모델 경로
										const model = await tf.loadLayersModel('{% static "model/model.json" %}');
										console.log(model.name, "model logged successfully");
										//

										// results parsing 하는 부분.
										function json2tensor(results){
											var point = tf.tensor([]);
											const flattenLayer = tf.layers.flatten();
											for (const landmarks of results.multiHandLandmarks[0]) {
												point = tf.concat([point,tf.tensor([landmarks.x,landmarks.y])]);
											}
											point = tf.reshape(point,[1,42]);
											return point;
										}

										function json3tensor(ll){
											var point = tf.tensor([]);
											for (const landmarks of ll) {
												point = tf.concat([point,tf.tensor([landmarks[0],landmarks[1]])],0);
											}
											point = tf.reshape(point,[1,42]);
											return point;
										}
										function calc_landmark_list(landmarks){
											const image_width = 500;
											const image_height = 400;
											var landmark_point = [];
											//console.log(landmarks[0]);
											if (landmarks.length <= 0){
												return landmark_point;
											}
											landmarks[0].forEach(function(landmark){
												var x = Math.min(parseInt(landmark.x * image_width), image_width - 1);
												var y = Math.min(parseInt(landmark.y * image_height), image_height - 1);

												landmark_point.push([x, y]);
											});
											//console.log("calc success", landmark_point.length);
											return landmark_point;
										}
										function pre_process_landmark(landmark_list){
											var tmp = landmark_list.slice();
											if(!tmp.length){
												return tmp;
											}
											var base_x = 0;
											var base_y = 0;
											var idx = 0;
											for(var landmark_point of tmp){
												if (idx == 0) {
													base_x = landmark_point[0];
													base_y = landmark_point[1];
												}

												tmp[idx][0] = landmark_point[0] - base_x;
												tmp[idx][1] = landmark_point[1] - base_y;
												idx++;
											}
											//console.log("tmp set", tmp.length, tmp);
											var ftmp = tmp.flat();
											for(var i=0;i<ftmp.length;i++){
												ftmp[i] = Math.abs(ftmp[i]);
											}
											var max_value = Math.max(...ftmp);
											//console.log()
											tmp.forEach(function(n){
												return n / max_value;
											});
											//console.log("pre_process success", tmp.length, tmp, max_value);
											return tmp;
										}
										function onResults(results) {
										  canvasCtx.save();
										  canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
										  canvasCtx.drawImage(
											  results.image, 0, 0, canvasElement.width, canvasElement.height);
										  if (results.multiHandLandmarks) {
											var landmark_ = calc_landmark_list(results.multiHandLandmarks);
											var pre_processed_landmark_list = pre_process_landmark(landmark_);
											for (const landmarks of results.multiHandLandmarks) {
											  drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
															 {color: '#00FF00', lineWidth: 5});
											  drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});
											}
											if (results.multiHandLandmarks[0]){
												//const predictionArray = model.predict(json3tensor(results)).dataSync();
												//console.log(json3tensor(pre_processed_landmark_list));
												//console.log(pre_processed_landmark_list);
												const predictionArray = model.predict(json3tensor(pre_processed_landmark_list)).dataSync();
												var max_Value = predictionArray.indexOf(Math.max(...predictionArray));
												console.log(max_Value);


												//predict 가 0 이면 Zoom In, 2 이면 Zoom Out
												if (max_Value == 0){
													var level = map.getLevel();
													map.setLevel(level+1);
												}
												else if (max_Value == 4){
													var level = map.getLevel();
													map.setLevel(level-1);
												}
											};
										  }
										  canvasCtx.restore();
										}

										// hand jesture with mediapose_api
										const hands = new Hands({locateFile: (file) => {
										  return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
										}});
										hands.setOptions({
										  maxNumHands: 2,
										  minDetectionConfidence: 0.8,
										  minTrackingConfidence: 0.5
										});
										hands.onResults(onResults);


										const camera = new Camera(videoElement, {
										  onFrame: async () => {
											await hands.send({image: videoElement});
										  },
										  width: 500,
										  height: 400
										});
										camera.start();
										</script>
								</section>
							</div>

							<ul class="actions">
								<li><a href="generic.html" class="button">Learn more</a></li>
							</ul>
						</div>
					</section>

				<!-- Three -->
					<section id="three" class="wrapper style1 fade-up">
						<div class="inner">
							<h2>Get in touch</h2>
							<p>Phasellus convallis elit id ullamcorper pulvinar. Duis aliquam turpis mauris, eu ultricies erat malesuada quis. Aliquam dapibus, lacus eget hendrerit bibendum, urna est aliquam sem, sit amet imperdiet est velit quis lorem.</p>
							<div class="split style1">
								<section>
									<form method="post" action="#">
										<div class="fields">
											<div class="field half">
												<label for="name">Name</label>
												<input type="text" name="name" id="name" />
											</div>
											<div class="field half">
												<label for="email">Email</label>
												<input type="text" name="email" id="email" />
											</div>
											<div class="field">
												<label for="message">Message</label>
												<textarea name="message" id="message" rows="5"></textarea>
											</div>
										</div>
										<ul class="actions">
											<li><a href="" class="button submit">Send Message</a></li>
										</ul>
									</form>
								</section>
								<section>
									<ul class="contact">
										<li>
											<h3>Address</h3>
											<span>12345 Somewhere Road #654<br />
											Nashville, TN 00000-0000<br />
											USA</span>
										</li>
										<li>
											<h3>Email</h3>
											<a href="#">user@untitled.tld</a>
										</li>
										<li>
											<h3>Phone</h3>
											<span>(000) 000-0000</span>
										</li>
										<li>
											<h3>Social</h3>
											<ul class="icons">
												<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
												<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
												<li><a href="#" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
												<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
												<li><a href="#" class="icon brands fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
											</ul>
										</li>
									</ul>
								</section>
							</div>
						</div>
					</section>

			</div>

		<!-- Footer -->
			<footer id="footer" class="wrapper style1-alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="{% static 'assets/js/jquery.min.js' %}"></script>
			<script src="{% static 'assets/js/jquery.scrollex.min.js' %}"></script>
			<script src="{% static 'assets/js/jquery.scrolly.min.js' %}"></script>
			<script src="{% static 'assets/js/browser.min.js' %}"></script>
			<script src="{% static 'assets/js/breakpoints.min.js' %}"></script>
			<script src="{% static 'assets/js/util.js' %}"></script>
			<script src="{% static 'assets/js/main.js' %}"></script>

	</body>
</html>